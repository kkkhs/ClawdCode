# 第八章：上下文管理

::: warning 施工中
本章节正在编写中，敬请期待...
:::

## 本章预览

本章将实现上下文管理系统：

- ContextManager 设计
- Token 计数器
- 自动压缩策略
- 会话持久化（JSONL）
- 多层存储架构

## 上下文管理架构

```
┌─────────────────────────────────┐
│        ContextManager           │
├─────────────────────────────────┤
│  TokenCounter │ CompactionService│
├─────────────────────────────────┤
│            Storage              │
│  ┌─────────┬─────────┬────────┐ │
│  │ Memory  │ Cache   │ JSONL  │ │
│  └─────────┴─────────┴────────┘ │
└─────────────────────────────────┘
```

## 压缩策略

当 Token 数量接近上限时：
1. 计算当前 Token 使用量
2. 触发压缩服务
3. 调用 LLM 生成摘要
4. 用摘要替换旧消息
5. 保留最近的消息

---

[返回教程首页](/guide/)
